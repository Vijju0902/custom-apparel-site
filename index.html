<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Apparel Mockup</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <div class="max-w-3xl w-full bg-white p-6 rounded-lg shadow-lg space-y-4">
    <h1 class="text-3xl font-bold text-center">Customize Your Apparel</h1>

    <!-- Step 1: Design Selection -->
    <h2 class="text-xl font-semibold">1. Select Design</h2>
    <div id="designs" class="grid grid-cols-3 gap-4">
      <img src="https://placehold.co/100x100/FBBF24/000000?text=Tiger" class="design border rounded cursor-pointer">
      <img src="https://placehold.co/100x100/EC4899/FFFFFF?text=Floral" class="design border rounded cursor-pointer">
      <img src="https://placehold.co/100x100/8B5CF6/FFFFFF?text=Astro" class="design border rounded cursor-pointer">
    </div>

    <!-- Step 2: Apparel Type -->
    <h2 class="text-xl font-semibold">2. Select Product</h2>
    <div id="products" class="grid grid-cols-3 gap-4">
      <button data-product="T-Shirt" class="product-btn border rounded p-2 bg-gray-200">T-Shirt</button>
      <button data-product="Hoodie" class="product-btn border rounded p-2 bg-gray-200">Hoodie</button>
      <button data-product="Sweatshirt" class="product-btn border rounded p-2 bg-gray-200">Sweatshirt</button>
    </div>

    <!-- Step 3: Mockup Preview -->
    <h2 class="text-xl font-semibold">3. Preview Mockup</h2>
    <canvas id="mockupCanvas" width="300" height="300" class="bg-gray-200 rounded"></canvas>

    <!-- Step 4: Customer Details -->
    <h2 class="text-xl font-semibold">4. Your Details</h2>
    <input id="name" type="text" placeholder="Name" class="border w-full p-2 rounded mb-2"><br>
    <input id="phone" type="text" placeholder="Phone" class="border w-full p-2 rounded mb-2"><br>
    <input id="address" type="text" placeholder="Address" class="border w-full p-2 rounded mb-2"><br>
    <input id="pincode" type="text" placeholder="Pincode" class="border w-full p-2 rounded mb-2"><br>

    <!-- Submit Button -->
    <button id="submit-btn" class="bg-blue-500 text-white px-4 py-2 rounded">Submit Order</button>

    <!-- Result Message -->
    <p id="result" class="text-center text-lg mt-4"></p>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwAvlQckmQu0Tx0FQM9qOK2GVzcVb-5wA6voSNQO3jFg3nXQk3A_Bd-XuZ044ClXmIxvA/exec";

let selectedDesign = null;
let selectedProduct = null;
let designImg = new Image();

// Design Selection
document.querySelectorAll('.design').forEach(img => {
  img.addEventListener('click', () => {
    selectedDesign = img.src;
    loadMockup();
  });
});

// Product Selection
document.querySelectorAll('.product-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    selectedProduct = btn.dataset.product;
    loadMockup();
  });
});

// Load Mockup on Canvas
function loadMockup() {
  if (!selectedDesign || !selectedProduct) return;

  const canvas = document.getElementById('mockupCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Simulated apparel background
  ctx.fillStyle = '#ccc';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  designImg = new Image();
  designImg.crossOrigin = 'Anonymous';
  designImg.src = selectedDesign;

  designImg.onload = () => {
    ctx.drawImage(designImg, 100, 100, 100, 100);
    ctx.font = "20px Arial";
    ctx.fillStyle = "#000";
    ctx.fillText(selectedProduct, 100, 250);
  };
}

// Submit Data
document.getElementById('submit-btn').addEventListener('click', () => {
  if (!selectedDesign || !selectedProduct) {
    alert("Please select both a design and a product.");
    return;
  }

  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const pincode = document.getElementById('pincode').value.trim();

  if (!name || !phone || !address || !pincode) {
    alert("Please fill in all details.");
    return;
  }

  const canvas = document.getElementById('mockupCanvas');
  const mockupImage = canvas.toDataURL('image/png').split(',')[1]; // base64

  const payload = {
    name,
    phone,
    address,
    pincode,
    products: selectedProduct,
    filename: `${name.replace(/\s/g, '_')}_${Date.now()}.png`,
    image: mockupImage
  };

  fetch(SCRIPT_URL, {
    method: 'POST',
    body: JSON.stringify(payload),
    mode: 'cors'
  })
  .then(res => res.json())
  .then(data => {
    if (data.result === 'success') {
      document.getElementById('result').textContent = "✅ Order submitted successfully!";
    } else {
      document.getElementById('result').textContent = "❌ Failed to submit order.";
    }
  })
  .catch(err => {
    console.error(err);
    document.getElementById('result').textContent = "❌ Error submitting order.";
  });
});
</script>

</body>
</html>
